/* /** 
 * taylor-editor - v0.0.0 - 2014-12-13
 * http://taylor-editor.herokuapp.com 
 * 
 * Copyright (c) 2014 ishmaelthedestroyer
 * Licensed  <>
 * */
 var __indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};!function(a,b){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;return G=null,H=null,C=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],L=function(a){return a.replace(/^\s+|\s+$/g,"")},B=function(a){return a.replace(/\n/g,"<br />")},k=function(a){return a.replace(/<br\s*\/?>/gm,"\n")},r=function(a,b){var c,d,e,f;if(!a)return{};if(!b||"object"!=typeof b)return a;for(d=Object.keys(b),e=0,f=d.length;f>e;e++)c=d[e],a[c]=b[c];return a},A=function(a){return"object"==typeof Node?a instanceof Node:a&&"object"==typeof a&&"number"==typeof a.nodeType&&"string"==typeof a.nodeName},y=function(a){return"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName},F=function(){var b,c,d,e;if(e=a.getSelection(),e.getRangeAt&&e.rangeCount){for(d=[],b=0,c=e.rangeCount;c>b;)d.push(e.getRangeAt(b)),++b;return d}return null},E=function(b){var c,d,e,f;if(e=a.getSelection(),b){for(e.removeAllRanges(),c=0,d=b.length,f=[];d>c;)e.addRange(b[c]),f.push(++c);return f}},v=function(){var a,c;return a=b.getSelection().anchorNode,c=a&&3===a.nodeType?a.parentNode:a},w=function(){var c;return c="",a.getSelection?c=a.getSelection().toString():b.selection&&"Control"!==b.selection.type&&(c=b.selection.createRange().text),c},u=function(){var c,d,e,f,g;if(d="",a.getSelection){if(g=a.getSelection(),g.rangeCount){for(c=b.createElement("div"),e=0,f=g.rangeCount;f>e;)c.appendChild(g.getRangeAt(e).cloneContents()),++e;d=c.innerHTML}}else b.selection&&"Text"===b.selection.type&&(d=b.selection.createRange().htmlText);return d},I=function(a,b,c){var d,e;return a.focus(),a.setSelectionRange?a.setSelectionRange(b,c):a.createTextRange?(d=a.value.replace(/\r\n/g,"\n"),b-=d.slice(0,b).split("\n").length-1,c-=d.slice(0,c).split("\n").length-1,e=a.createTextRange(),e.collapse(!0),e.moveEnd("character",c),e.moveStart("character",b),e.select()):void 0},z=function(a){var b,c;for(b=a.parentNode,c=b.tagName.toLowerCase();-1===C.indexOf(c)&&"div"!==c;){if("li"===c)return!0;if(b=b.parentNode,!b||!b.tagName)return!1;c=b.tagName.toLowerCase()}return!1},l=function(){var b,c;return b=a.getSelection(),c=t(),m(b,c)},m=function(a){var b;try{G=a,H=G.getRangeAt(0)}catch(c){b=c}},t=function(){var b,c,d,e,f,g,h;try{G=a.getSelection(),g=G.getRangeAt(0),b=g.commonAncestorContainer,f=b.parentNode,h=null}catch(i){return c=i,null}e=function(a){var b;f=a;try{for(;!f.getAttribute("data-taylor-element");)f=f.parentNode}catch(c){return b=c,!1}return f};try{h=b.getAttribute("data-taylor-element")?b:e(f)}catch(i){d=i,h=e(f)}return h},s=function(a){var b;for(b="",a&&a.tagName&&(b=a.tagName.toLowerCase());a&&-1===C.indexOf(b);)a=a.parentNode,a&&a.tagName&&(b=a.tagName.toLowerCase());return{element:a,tagName:b}},q=function(a){var c;return c=s(G.anchorNode),"blockquote"===a&&c.element&&"blockquote"===c.element.parentNode.tagName.toLowerCase()?b.execCommand("outdent",!1,null):(c.tagName===a&&(a="p"),b.execCommand("formatBlock",!1,a))},K=function(a){var c,d,e;return"a"===G.anchorNode.parentNode.tagName.toLowerCase()?b.execCommand("unlink",!1,null):(e=prompt("Please enter the url you want to link to.","http://"),-1===e.toLowerCase().indexOf("http")&&(e="http://"+e),d=w(),c='<a href="'+e+'">'+d+"</a>",b.execCommand("insertHTML",!1,c),a?J():void 0)},J=function(){var a,b,c;if(a=v(),"a"===a.tagName.toLowerCase())return a.target="_blank";for(a=a.getElementsByTagName("a"),b=0,c=[];b<a.length;)a[b].target="_blank",c.push(++b);return c},o=function(a){var c,d,e,f,g,h;return a._container.className+=" taylor-editor",a._container.className+=" panel",a._container.className+=" panel-default",a._container.style.width=a._options.width,f=b.createElement("div"),f.className="panel-heading",f.style.height="auto",a._container.appendChild(f),e=b.createElement("ul"),e.className="nav",e.className+=" navbar-nav",e.className+=" taylor-controls",f.appendChild(e),h=b.createElement("ul"),h.className="nav",h.className+=" navbar-nav",h.className+=" navbar-right",h.className+=" taylor-tools",f.appendChild(h),a._buttons=n(a,e),a._tools=p(h,a._options.tools),d=b.createElement("div"),d.style.clear="both",f.appendChild(d),c=a._editable=b.createElement("div"),c.className="panel-body",c.className+=" form-control",c.className+=" taylor-editable",c.setAttribute("data-taylor-editable",!0),c.style.height=a._options.height,c.style.overflowY="auto",c.contentEditable=!0,c.innerHTML=a._HTML,c.setAttribute("placeholder",a._options.placeholder),a._container.appendChild(c),g=a._textarea=b.createElement("textarea"),g.className="textarea",g.className+=" form-control",g.className+=" taylor-textarea",g.style.height=a._options.height,g.style.display="none",g.placeholder=a._options.placeholder,a._container.appendChild(g),a},n=function(a,c){var d,e,f,g,h,i,j,k,l,m,n,o,p;if(d=a._options.buttons,l={bold:{name:"bold",action:"bold",element:"b","class":"fa fa-bold",content:""},italic:{name:"italic",action:"italic",element:"i","class":"fa fa-italic",content:""},underline:{name:"underline",action:"underline",element:"u","class":"fa fa-underline",content:""},strikethrough:{name:"strikethrough",action:"strikethrough",element:"strike","class":"fa fa-strikethrough",content:""},h:{name:"h",action:"append-h1",content:"<b>H</b>",element:"h1"},h2:{name:"h2",action:"append-h2",content:"<b>H2</b>",element:"h2"},h3:{name:"h3",action:"append-h3",content:"<b>H3</b>",element:"h3"},h4:{name:"h4",action:"append-h4",content:"<b>H2</b>",element:"h4"},h5:{name:"h5",action:"append-h5",content:"<b>H5</b>",element:"h5"},h6:{name:"h6",action:"append-h6",content:"<b>H6</b>",element:"h6"},subscript:{name:"subscript",action:"subscript",element:"sub","class":"fa fa-strikethrough",content:""},blockquote:{name:"blockquote",action:"append-blockquote",element:"blockquote","class":"fa fa-quote-right",content:""},unorderedlist:{name:"unorderedlist",action:"insertunorderedlist",element:"ul","class":"fa fa-list-ul",content:""},orderedlist:{name:"orderedlist",action:"insertorderedlist",element:"ol","class":"fa fa-list-ol",content:""},pre:{name:"pre",action:"append-pre",element:"pre","class":"fa fa-code",content:""},anchor:{name:"anchor",action:"anchor",element:"a","class":"fa fa-link",content:""},image:{name:"image",action:"image",element:"img","class":"fa fa-picture-o",content:""}},a._options.templates){p=a._options.templates;for(e in p){k=p[e];for(i in k)m=k[i],l[e][i]=m}}for(g=[],j=Object.keys(l),f=function(a){var d,e,f,g;if(g=a.name,!(__indexOf.call(j,g)>=0))throw new Error("That button type does not exist!");return e=b.createElement("li"),c.appendChild(e),d=b.createElement("button"),d.className="taylor-btn",d.className+=" taylor-btn-"+a.name,d.setAttribute("data-taylor-btn-action",a.action),e.appendChild(d),f=b.createElement("span"),f.className=a["class"],f.innerHTML=a.content||"",d.appendChild(f),a.element=d,a},g=[],n=0,o=d.length;o>n;n++)h=d[n],g.push(f(l[h]));return g},p=function(a,c){var d,e,f,g,h,i;for(g={preview:{name:"preview",action:"preview","class":"fa fa-eye",content:""},help:{name:"help",action:"help","class":"fa fa-question",content:""}},d=function(c){var d,e,f;return e=b.createElement("li"),a.appendChild(e),d=b.createElement("button"),d.className="taylor-btn",d.className+=" taylor-tool-"+c.name,d.setAttribute("data-taylor-btn-action",c.action),e.appendChild(d),f=b.createElement("span"),f.className=c["class"],f.innerHTML=c.content||"",d.appendChild(f),c.element=d,c},e=[],h=0,i=c.length;i>h;h++)f=c[h],e.push(d(g[f]));return e},d=function(c,d){var e,f,g,h,i;for(f=c._options.override?Object.keys(c._options.override):[],g=function(d){return f.indexOf(d.name)>-1?(d.element.addEventListener("click",c._options.override[d.name],!1),!1):d.element.addEventListener("click",function(e){return e.preventDefault(),e.stopPropagation(),G&&l(),d.action.indexOf("append-")>-1?q(d.action.replace("append-","")):"anchor"===d.action?K(c._options.targetBlank):"image"===d.action?b.execCommand("insertImage",!1,a.getSelection()):b.execCommand(d.action,!1,null),this})},h=0,i=d.length;i>h;h++)e=d[h],g(e)},j=function(a,b){var c,d,e,f;for(f=[],d=0,e=b.length;e>d;d++)c=b[d],f.push(function(b){return"preview"===b.action?b.element.addEventListener("click",function(){return D(a)}):void 0}(c));return f},h=function(a,c){var d,e,f;return e=null,f=function(){return clearTimeout(e),e=setTimeout(function(){return l()},c||0)},d=b.documentElement,d.addEventListener("mouseup",f),a.addEventListener("keyup",f),a.addEventListener("blur",f),this},f=function(a,c){var d;return d=function(d){var e,f,g;if(e="",a.classList.remove("taylor-editor-placeholder"),d.clipboardData&&d.clipboardData.getData){if(d.preventDefault(),c){for(g=d.clipboardData.getData("text/plain").split(/[\r\n]/g),f=0;f<g.length;)""!==g[f]&&(e+="<p>"+g[f]+"</p>"),++f;return b.execCommand("insertHTML",!1,e)}return b.execCommand("insertHTML",!1,d.clipboardData.getData("text/plain"))}},a.addEventListener("paste",d),this},e=function(a,c){return a.addEventListener("keyup",function(a){var d,e;return d=v(),d&&d.getAttribute("data-taylor-editable"&&!d.children.length&&!c)&&b.execCommand("formatBlock",!1,"p"),13!==a.which||a.shiftKey||(d=v(),e=d.tagName.toLowerCase(),c||"li"===e||z(d)||(b.execCommand("formatBlock",!1,"p"),"a"!==e))?void 0:b.execCommand("unlink",!1,null)}),this},i=function(a){return a.addEventListener("keydown",function(a){var c;return 9===a.which?(a.preventDefault(),c=v().tagName.toLowerCase(),"pre"===c?b.execCommand("insertHTML",null,"    "):b.execCommand("insertHTML",null,"&nbsp;&nbsp;&nbsp;&nbsp;")):void 0}),this},g=function(a,b){return a.addEventListener("keypress",function(c){return 13===c.which&&(b||a.getAttribute("data-disable-return"))?c.preventDefault():void 0}),this},x=function(a,b){var c;if(!a._container)throw new Error("Taylor target element does not exist!");return c={width:"100%",height:"500px",placeholder:"",anchorPlaceholder:"Type a URL",buttons:["bold","italic","underline","strikethrough","h","orderedlist","unorderedlist","blockquote","pre","anchor","image"],tools:["preview"],disableReturn:!1,targetBlank:!0,delay:0,sticky:!1},a._options=r(c,b),o(a),d(a,a._buttons||[]),j(a,a._tools||[]),h(a._container,a._options.delay),f(a._container,a._options.disableReturn),e(a._container,a._options.disableReturn),i(a._container),g(a._container),this},D=function(a){var b,c,d,e;return b=a._container.getElementsByClassName("taylor-editable")[0],e=a._container.getElementsByClassName("taylor-textarea")[0],c=a._container.getElementsByClassName("taylor-tool-preview")[0],d=c.getElementsByClassName("fa")[0],"none"!==b.style.display?(b.style.display="none",e.style.display="",e.value=k(b.innerHTML),d.classList.remove("fa-eye"),d.classList.add("fa-eye-slash")):(b.style.display="",e.style.display="none",b.innerHTML=B(e.value),d.classList.add("fa-eye"),d.classList.remove("fa-eye-slash"))},c=function(a,d){var e;if(!(this instanceof c))return new c(a,d);if(this._container=y(a)?a:b.querySelector(a),!this._container)throw new Error("Couldn't initialize Taylor, element not found!");return this._HTML=L(this._container.innerHTML),this._editable=null,this._textarea=null,this._buttons=[],this._HTML.length||(this._HTML="<p></p>"),this._container.innerHTML="",x(this,d||{}),e=this._container.getElementsByClassName("taylor-editable")[0],I(e,0,0),this._options.onLoad&&this._options.onLoad(this,d),this},c.prototype["export"]=function(){var a,b;return a=this._container.getElementsByClassName("taylor-editable")[0],b=this._container.getElementsByClassName("taylor-textarea")[0],"none"!==a.style.display?k(a.innerHTML):b.value},c.prototype.clear=function(){var a,b;return a=this._container.getElementsByClassName("taylor-editable")[0],b=this._container.getElementsByClassName("taylor-textarea")[0],a.innerHTML="",b.innerHTML=""},c.prototype.set=function(a){var b,c;return b=this._container.getElementsByClassName("taylor-editable")[0],c=this._container.getElementsByClassName("taylor-textarea")[0],b.innerHTML=a,c.innerHTML=a},c.prototype.insert=function(a){var b,c;return b=this._container.getElementsByClassName("taylor-editable")[0],c=this._container.getElementsByClassName("taylor-textarea")[0],b.innerHTML=b.innerHTML+a,c.innerHTML=c.innerHTML+a},c.prototype.getSelectionStart=function(){return G},c.prototype.isFocused=function(){var c,d;return d=function(a,b){for(;a;){if(a===b)return!0;a=a.parentNode}return!1},(c=function(c){var e,f,g;if(g=void 0,a.getSelection){g=a.getSelection();try{if(g.rangeCount>0){for(f=0;f<g.rangeCount;){if(!d(g.getRangeAt(f).commonAncestorContainer,c))return!1;++f}return!0}}catch(h){return e=h,!1}}else if((g=b.selection)&&"Control"!==g.type)return d(g.createRange().parentElement(),c);return!1})(this._editable||c(this._textarea))},c.prototype.focus=function(){var c;return(c=function(c){var d,e,f;return c.focus(),"undefined"!=typeof a.getSelection&&"undefined"!=typeof b.createRange?(d=b.createRange(),d.selectNodeContents(c),d.collapse(!1),e=a.getSelection(),e.removeAllRanges(),e.addRange(d)):"undefined"!=typeof b.body.createTextRange?(f=b.body.createTextRange(),f.moveToElementText(c),f.collapse(!1),f.select()):void 0})("none"!==this._editable.style.display?this._editable:this._textarea)},a.Taylor=c}(window,document);